---
sort: 3
---


# 调研报告

* [算法开发手册](https://kg-nlp.github.io/Algorithm-Project-Manual/表格解析/调研报告.html)

* [个人知乎](https://www.zhihu.com/people/zhangyj-n)



## 什么是表格问答
* 表格问答（TableQA），是指根据给定的表格，针对表格相关内容的查询、推理等问题，提供对应智能问答能力。
* 利用模型将自然语言转换为 SQL 查询语言，允许用户使用自然语言与表格知识直接交互并返回直观、流畅、忠实的结果。用户通过语音或者文本进行提问，通过自然语言的理解最终形成相关的 SQL 语句，通过对话管理做状态追踪和策略优化，然后去查询相关的知识库及 API，根据得到的内容通过自然语言生成问题答案。上述的这个流程就是表格问答的核心链路。  

> [阿里-表格问答功能概述](https://help.aliyun.com/document_detail/450645.html?spm=a2c4g.450629.0.0.75451caff1cGN3)    
> [大规模表格预训练模型 SPACE-T](https://zhuanlan.zhihu.com/p/622616839)

## 通常的智能问答有哪些
* 通常智能问答任务可分为 FAQ 问答，知识图谱问答，表格问答，文档问答四大类。
* FAQ 问答，基于事先准备好的问答对 （question-answer pairs），用户问题和库中问题做语义匹配，返回已有问题对应的答案
* 知识图谱问答，通过对问题进行语义理解及解析，然后在知识图谱中进行查询。
* 文档问答：基于给定文本直接生成问题对应的答案，文档问答任务可以进一步分为答案句子选择和机器阅读理解两大类。
* 表格问答，根据给定的表格，通过某种方式解析用户意图，直接命中表格的某个单元格，直接返回信息给用户，不需要用户二次加工。
> [表格问答在客服场景下的落地应用](https://zhuanlan.zhihu.com/p/431970230)

## 为什么要进行表格问答
* 数据中台有非常多的文档表格，网页表格以及关系型数据库，如果能够直接利用这些数据进行智能化系统构建可以为中台赋能。
* 表格是一种信息密度很高的数据结构。用表格来提供信息不仅方便业务端梳理知识，而且结构化的数据既可以对算法端(倾向机器学习)进行信息聚合、也提供了精准命中答案的可能性，不需要用户二次加工。
* 当给出一份报表时想要提取里面的信息，首先，用肉眼去筛选满足条件的数据，是最方便直观的方法，但显然也是效率最低的一种方式。也可以采用一些工具，如Excel等，或者可以选择将表格导入数据库，然后使用数据库语言来进行高效的检索。但是，并不是所有人都懂SQL语法，擅长Excel函数。这些工具的使用难度限制了非技术用户，我们希望设计一种通过自然语言来对表格数据进行检索、计算等操作的系统，于是就有了表格问答。

> [表格问答在客服场景下的落地应用](https://zhuanlan.zhihu.com/p/431970230)  
> [想了解表格问答，我们先看看TA的前世](https://zhuanlan.zhihu.com/p/325715296)

## 表格问答的行业背景
* 企业在做智能化过程中会面临一个问题，对于企业里面的相关知识文档以及数据，以各种形态进行存放，比如表格等，这样逐步构成了企业数据库和数据中台，从而衍生出 OA 等企业信息化系统。但是如何从这些大规模的数据中得到一些企业的决策信息或者达到降本增效的功能，这时候需要做各种知识图谱、对话相关的智能系统，如：智能对话、智能 BI 分析。
* 各行业企业花费了大量资源搭建了企业的数据中台，支撑了企业信息化系统。但是仍需要花费大量精力重头梳理相关业务知识（知识图谱流程、问答、对话等），才能构建起企业智能化系统。这样就面临一个挑战：能否利用企业数据中台直接构建智能化系统？
* 对于企业来说，常见的一些文档表格、网页表格以及关系型数据库都是二维的表信息。如果能够直接利用这些数据进行智能化系统构建，可以大幅度降低相关的成本。

> [大规模表格预训练模型 SPACE-T](https://zhuanlan.zhihu.com/p/622616839)  

## 表格问答的应用场景
* 表格数据高度结构化，不同表格之间不必遵循统一的本体结构和命名规范，表格的编辑和修改可以高效进行，具有较强的可编辑性和时效性。这些特点使得表格问答能够在诸多应用场景发挥重要的作用。
* 表格问答具有两个重要的研究方向：结合智能交互，支持对结构化数据查询与问答；优化搜索引擎，智能并高效地检索结构化文本。
* **表格问答应用场景**
    *  保费查询、客户信息查询等内部业务数据查询
    *  覆盖行情信息、行业研报报表、财务报表等结构化数据
    *  支持酒店信息、火车票与飞机票查询等出行场景问答
    *  商品销量、商品详情、商品筛选与推荐等电商场景
    *  产品信息、活动细则等新零售场景问答
    *  话费查询、缴费查询、业务查询等日常生活问答
* **业务场景数据特点和业务诉求**(阿里业务分析)
    * 金融类:
        * 数据特点：表格多，数据量大，存在多表关联，对于推理计算相关能力需求高，如最值、平均等
        * 业务诉求：解决用户对金融产品咨询的问题；部分场景有BI分析的诉求
    * 零售类:
        *  数据特点：表格多，型号多，属性重合度高，如长宽高、颜色等，数据变动频繁，如上下架、价格调整等
        * 业务诉求：解决用户对售前的咨询相关的问题，降低成本；
    * 政策类：
        *  数据特点：层次化明显、结构相对固定，如办理时间、办理地点等，政策量大需要快速构建；
        *  业务诉求：解决用户对政策相关问答，包括语音口相关的渠道；

> [想了解表格问答，我们先看看TA的前世](https://zhuanlan.zhihu.com/p/325715296)  
> [大规模表格预训练模型 SPACE-T](https://zhuanlan.zhihu.com/p/622616839)


## 表格问答的落地挑战
* **表格的识别及规范化表示**:表格默认以第一行为表头，但在实际挖掘表格中，有三种情况：以第一行为表头，以第一列为表头，或者第一行和第一列共同表示表格；挖掘的表格存在信息缺失问题，如表名缺失、表格值不全等；同时，面对多个表格时缺失表间链接关系。
* **外界知识的利用**：有一些常识信息不包含在表格中，如排序操作的方向判断（列为“出生日期”，问题为“年龄最大的员工”）、表格值进制转换（列为“人口(亿)”，问题为“人口超5千万的城市”）等，这些信息需要引入外界知识来协助SQL生成。
* **融进渐进式对话**：对于用户的歧义表达和模糊表达，需要有“提问-反馈-再提问”的过程，这类问题往往需要通过多轮对话解决，而用户的问题通常是上下文相关的，因此需要模型具备基于上下文的理解和分析能力。

> [想了解表格问答，我们先看看TA的前世](https://zhuanlan.zhihu.com/p/325715296)

## 表格问答常见方案
* 端到端的 NL2SQL
    * NL2SQL（Natural Language to SQL）是一项将用户的自然语言语句转成可执行的 SQL 语句的技术。 
    
*  基于多轮对话形式的 SQL 关键字提取
    * 这种方式是把访客的意图看成一个任务型对话过程，首先把SQL常见的查询方式整理成一个对话流程，完成这个查询需要的条件，设置成对话中的槽位，通过一轮或者多轮从用户获取需要的 SQL 关键字，最后和用户确认查询的含义，并且返回最后的答案。

* OCR+信息抽取

> [表格问答在客服场景下的落地应用](https://zhuanlan.zhihu.com/p/431970230)  
> [文档智能应用](https://github.com/PaddlePaddle/PaddleNLP/tree/develop/applications/document_intelligence)

## 微软表格问答完整流程
* ![检索、语义解析、生成和对话](https://note.youdao.com/yws/api/personal/file/WEBf72f85e07916b23d9814010b9ad74947?method=download&shareKey=9ec7ab487aced962a8f4c2bfe87f988f)
* 如图所示，表格问答就是针对一个自然语言问题，根据表格内容给出答案。

    表格问答主要涉及的是图中检索和语义解析两个模块。检索模块在文档问答里也有，文档问答的检索模块是为了找到和问题相关的文档，而表格问答里检索模块的目标则是找到和问题相关的表格。这个模块只有在涉及大量表格（例如搜索引擎）的时候才会用到。
    
    语义解析是和文档问答中差别比较大的部分。在文档问答中是使用一个 reader 模型来处理检索到的文档(context)，而表格问答的侧重点则是处理问题(query)。语义解析模型的目标是结合表格信息将问题(如图中的Which city hosted Summer Olympic in 2008?)转化成一个机器可理解和执行的规范语义表示，对二维表而言这种表示通常就是 SQL 语句（如图中的SELECT City FROM SummerOlympic WHERE Year="2008")。有了 SQL 语句就可以执行得到针对问题的答案(如图中的Beijing)。
    
    在不需要表格检索的场景中，表格问答就简化成了一个自然语言转 SQL（nl2sql）问题
    
> [表格问答1：简介](https://zhuanlan.zhihu.com/p/128123561)

## 表格问答现有的技术方案

* [表格问答在客服场景下的落地应用](https://zhuanlan.zhihu.com/p/431970230)
    *  将表格的字段打上实体和属性的标签
    *  实体时列中的内容,属性是行中的内容
    *  实体和属性的识别可以通过关键词,或是短文本的语义识别
    *  表格问答设计成一种多轮对话的形式，用户可以在话术引导下，分多次提供有效的实体和属性信息，不需要一次对话就必须提供实体和属性信息，同时还可以支持实体或者属性的反问和推荐，进一步提升实用性
    
    > 上面这种方式适用于表格中单元格内容的检索,问题不能太复杂,如果有复杂语义,多种实体属性的请求,需要话术引导问答逐步回答, 或是引入实体关系抽取一次全部回答(暂且使用联合抽取的方法)


## 表格形式基本分为哪几种情况

在现实应用中存在不同类型的表格，它们的结构各不相同，按照表头的分布位置，我们可以初步将表格分为以下4种类型，如下图所示：

- **垂直表格**：第一行是列表头，其余行是沿垂直方向排布的数据，这是最基本的表格类型。
- **水平表格**：第一列是行表头，其余列是沿水平方向排布的数据，比如维基百科经常使用水平表格记录人物信息。
- **层级表格**：表头呈现出层级结构，表格中包含合并单元格，比如统计报告和学术论文经常使用层级表格来展示结果，有些层级表格的行表头和列表头可能都存在层级结构，需要同时考虑行列两个方向的表头来理解数据。
- **复杂表格**：上述3种表格的表头只分布于表格的左方或者上方，而复杂表格的表头可以分布于表格的任意位置，尤其是表头的右下方区域，并可能与普通数据混合在一起，比如专业设备的文档中可能利用这类表格记录设备的基本信息、政府部门的登记表格、公司的面试申请表等也多为复杂表格。

![](https://github.com/SpursGoZmy/Tabular-LLM/blob/main/tabular_llm_figures/table_types.png?raw=true)

> [Tabular LLM：构建面向表格智能任务的大型语言模型](https://github.com/SpursGoZmy/Tabular-LLM)

## 表格智能LLM和文档智能模型有什么不同之处

* 前者更关注表格独立存在的场景，用于专门处理表格这一种元素，可以对表格进行修改、问答、生成文本描述等；
* 后者更关注表格存在于文档中的场景，用于综合处理表格、文本、图片等多种元素构成的文档图像，可以基于文档图片提取表格信息、进行问答。

> [Tabular LLM：构建面向表格智能任务的大型语言模型](https://github.com/SpursGoZmy/Tabular-LLM)

## 为了模型学习,表格有哪些表示方式

* 启发式文本序列格式

和常见的预训练模型一样，学界现有的表格预训练模型同样可以分为判别式模型和生成式模型。

判别式表格预训练模型采用类似BERT的结构（Encoder），典型模型包括[TAPAS](https://arxiv.org/abs/2004.02349)、[TableFormer](https://arxiv.org/abs/2203.00274)、[TABERT](https://arxiv.org/abs/2005.08314)等，它们的目标是学习到好的表格表示来支持下游任务，包括单元格表示向量、列表示向量等。这类模型通常会在BERT原有嵌入层的基础上，通过引入额外的嵌入层来表示表格的结构，包括列ID嵌入、行ID嵌入等，比如TAPAS模型的嵌入层如下所示。
![](https://github.com/SpursGoZmy/Tabular-LLM/raw/main/tabular_llm_figures/tapas_table_representation.png)

生成式表格预训练模型采用类似BART、T5的结构（Encoder-Decoder），典型模型为[TAPEX](https://arxiv.org/abs/2107.07653)，当然采用类似GPT的Decoder结构也是可以的，只是没人做hh，它们的目标是采用Seq2Seq的方式直接完成下游任务，比如直接回答关于表格的问题。这类模型在输入端需要采用某种启发式方法，将表格转化为一个文本序列，如下图所示，TAPEX模型需要将表格拉直为：[HEAD] 列表头1 | 列表头2 | … [ROW] 1 第一行第一列的单元格 | 第一行第二列的单元格 | … [ROW] 2 第二行第一列的单元格 | 第二行第二列的单元格 | …  。
![](https://github.com/SpursGoZmy/Tabular-LLM/raw/main/tabular_llm_figures/tapex_table_representation.png)

* Markdown格式

ChatGPT、文心一言等模型目前应该是采用Markdown格式来表示表格，使用 “|” 来分隔不同的单元格，使用 “-” 来分隔表头所在的第一行和其他行，如下所示。
![](https://github.com/SpursGoZmy/Tabular-LLM/raw/main/tabular_llm_figures/markdown_table.png)
可以发现，基于纯文本格式和Markdown格式的表示方法更适合表示结构较为简单的垂直表格或水平表格，无法很好地表示更复杂的表格结构，比如可能包含合并单元格的层级表格和复杂表格。

* HTML格式

为了表示更复杂的表格结构，尤其是合并单元格，我们可以使用HTML格式来表示表格，每对【&lt;tr&gt;.....&lt;/tr&gt;】标签之间为表格的一行，每对 【&lt;td&gt;....&lt;/td&gt;】 标签之间为一行中不同列的单元格，利用【rowspan=m, colspan=n】参数指定某个单元格可以占据m行n列，如下所示。除了能表示合并单元格，HTML还可以设定单元格对齐、单元格背景颜色等表格样式。
![](https://github.com/SpursGoZmy/Tabular-LLM/raw/main/tabular_llm_figures/HTML_table.png)

* Latex格式

大家在写论文时也会用Latex代码来表示表格，同样可以支持合并单元格，文本对齐等格式，如下所示：
![](https://github.com/SpursGoZmy/Tabular-LLM/raw/main/tabular_llm_figures/latex_table.png)

## 怎么选择合适的表格表示方法
* **底座LLM的代码能力**：如果你的底座LLM模型具有较强的代码能力，那么选择HTML格式或者Latex格式表示表格可能更为合适，强大如GPT-4，直接给它提供HTML格式的表格，然后进行表格问答都是可以的。但如果你的底座LLM模型的代码理解能力较弱，那么可能更适合使用Markdown格式或者直接用某种启发式格式将表格拉直，目的是构建出更贴近自然语言的表格表示，降低模型学习的难度。
* **具体的应用场景**：“LLM+具体行业应用场景”的结合已经屡见不鲜，由于不少行业会产生大量的表格数据，这也就带来了新的可能性：为某个具体行业甚至是具体软件“量身定制”一个表格智能LLM，从而给用户提供更友好便捷的表格处理方式。在这种情况下，我们或许只能让LLM“迁就”该行业或者该软件使用的特定表格表示方法，然后通过训练数据让LLM理解这种表示方法。
    
    * 以微软的Excel为例，其背后也会有一套表格表示方法以及操作表格的编程语言VBA，那么为了开发配合Excel使用的LLM，可能就需要收集相应格式的数据来训练LLM理解这种格式的表格和用户需求，然后让LLM直接生成回复或者生成反映用户需求的VBA代码，最后执行代码返回结果。比如，用户可能会输入用自然语言表示的需求“帮我把行表头对应单元格的字体加粗”或者“帮我在表格后面新增一列，计算B列和C列的差值”，表格智能LLM就需要理解Excel表格并生成VBA代码，最终执行代码返回更新后的表格。整体流程可能如下所示：
    ![](https://github.com/SpursGoZmy/Tabular-LLM/raw/main/tabular_llm_figures/potential_tabular_llm_for_excel.png)

> [Tabular LLM：构建面向表格智能任务的大型语言模型](https://github.com/SpursGoZmy/Tabular-LLM)